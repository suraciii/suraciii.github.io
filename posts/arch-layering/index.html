<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=http://suraciii.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.css><title>浅谈架构设计之分层</title></head><body><header id=banner><h2><a href=http://suraciii.github.io/>The Dice Maker</a></h2><nav><ul></ul></nav></header><main id=content><article><header id=post-header><h1>浅谈架构设计之分层</h1><div><time>May 13, 2022</time></div></header><p><em>本文是某次分享的摘要</em></p><h3 id=架构分层>架构分层</h3><ul><li>将复杂的系统分割成位于不同层次的模块</li><li>将实现细节隐藏在各个层面的模块中</li><li>降低认知负担，改动成本和风险</li></ul><h3 id=分层的原则>分层的原则</h3><p>总结的三个主要原则：</p><ul><li>不同的分层，建立不同的抽象</li><li>关注点分离</li><li>层内高内聚、层间低耦合</li></ul><p>其它一些分层原则：</p><ul><li>层与层之间不应有循环依赖</li><li>业务层不应该包括非业务代码，反之亦然</li><li>各层应能够独立测试</li><li>低层不应依赖高层</li><li>分层是逻辑上的抽象，不一定意味着物理上的分离</li></ul><p><em>这些分层原则主要来自于 1. 《A Philosophy of Software Design》 John Ousterhout, 2. 《LayeringPrinciples》 Martin Fowler</em></p><h3 id=三层架构>三层架构</h3><p><img src=/arch-layering/3tiers.png alt></p><p>人（前端/客户端）&lt;-> 应用 &lt;-> 数据库</p><p><img src=/arch-layering/3layers.png alt></p><ul><li>展示层：人和应用的交互</li><li>数据层：应用对数据的存取</li><li>依赖方向从上至下</li></ul><h3 id=六边形架构>六边形架构</h3><p><img src=/arch-layering/hex.png alt></p><ul><li>核心层：应用逻辑</li><li>外层：UI、HTTP API、日志、配置、数据库、缓存、邮件通知等 - <em>虽然这些模块有着不同的关注点，但是在层次上是在同一层</em></li><li>依赖方向：从左到右</li></ul><h3 id=存在的问题>存在的问题</h3><p><img src=/arch-layering/3layers-problem.png alt></p><p>对于业务系统：</p><ul><li>业务的数据结构和关系存在于数据库中，<strong>业务逻辑和应用逻辑</strong>混淆在一起</li><li>业务模型的<strong>数据和行为分离</strong>，导致认知负担及改动风险</li><li>基于数据库设计数据结构产生不准确的模型</li></ul><h3 id=领域驱动设计四层架构>领域驱动设计：四层架构</h3><p><img src=/arch-layering/4layers-1.png alt></p><ul><li>领域层：新的抽象</li><li>区分于应用层，领域层内由体现业务领域中的知识的同时具备数据和行为的领域模型构成，不包含和应用相关的代码</li></ul><p>依赖反转——</p><p><img src=/arch-layering/4layers-2.png alt></p><ul><li>应用层是控制面</li><li>领域层中是纯粹的领域模型</li><li>领域层不依赖基础设施，不关心应用逻辑</li></ul><h3 id=洋葱架构>洋葱架构</h3><p><img src=/arch-layering/onion.png alt></p><ul><li>依赖流由外向内</li><li>以领域层中的领域模型为核心</li><li>核心领域模型专注于对业务领域进行抽象</li><li>首先建立领域模型，围绕领域模型建立数据库表结构，填充应用功能</li></ul><h4 id=具备领域层的六边形架构>具备领域层的六边形架构</h4><p><img src=/arch-layering/hex-2.png alt></p><h4 id=整洁架构>整洁架构</h4><p><img src=/arch-layering/clean.png alt></p><h3 id=总结>总结</h3><ul><li>总体分为核心层和非核心层</li><li>应用层比较薄，不涉及业务逻辑和知识，只负责协调任务并将工作传递到下一层来处理</li><li><strong>如无必要、勿增抽象</strong> <em>层次越多，抽象越多，理解越困难</em></li></ul><h3 id=纵向切分>纵向切分</h3><ul><li>主要关注于对模块边界的识别</li><li>在多个层面中分别进行</li></ul></article></main><footer id=footer></footer></body></html>